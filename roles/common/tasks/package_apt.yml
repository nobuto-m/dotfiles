---
- name: enable -proposed
  template:
    src=templates/proposed.list.j2
    dest=/etc/apt/sources.list.d/proposed.list

- name: set apt_preferences for -proposed
  copy:
    src=files/proposed
    dest=/etc/apt/preferences.d/proposed

- name: apt update
  apt: update_cache=yes cache_valid_time=3600

- name: install eatmydata
  apt: name=eatmydata state=present

- name: apt dist-upgrade
  apt: upgrade=dist
  environment: "{{ eatmydata }}"

- name: apt install packages
  apt: name={{ item }} state=present
  with_items: "{{ packages }}"
  environment: "{{ eatmydata }}"

- name: disable unattended-upgrades
  apt: name=unattended-upgrades state=absent purge=yes

- name: check language support
  command: check-language-support
  register: language_support
  changed_when: False

- name: install language support
  apt: name={{ item }} state=present
  with_items: "{{ language_support.stdout.split() }}"
  environment: "{{ eatmydata }}"

- name: configure apt-listchanges
  copy:
    src=files/listchanges.conf
    dest=/etc/apt/listchanges.conf

- name: keep Firefox as primary browser - gnome-www-browser
  alternatives: name=gnome-www-browser path=/usr/bin/firefox

- name: keep Firefox as primary browser - x-www-browser
  alternatives: name=x-www-browser path=/usr/bin/firefox

- name: build diff-highlight
  command: make -C /usr/share/doc/git/contrib/diff-highlight/
  changed_when: False

- name: diff-highlight executable
  copy: src=/usr/share/doc/git/contrib/diff-highlight/diff-highlight dest=/usr/local/bin/diff-highlight mode=0755
