#!/bin/bash

set -e
set -u

secret_file=~/.otp-ubuntu.secret
# make sure those files are private
chmod 600 "$secret_file"

secret=$(cat "$secret_file" | sed -e 's/ //g')

otp=$(oathtool --totp "$secret")

if which xdotool > /dev/null; then
    # "xdotool type" doesn't work in Wayland.
    # "--clearmodifiers" will press Super at the end.
    echo "$otp" | sed -e 's/./key \0\n/g' \
        | xargs xdotool keyup super+ctrl+shift+alt
    xdotool key Return
    exit
elif which xclip > /dev/null; then
    echo "$otp" | xclip -selection clip
fi
echo "$otp"
